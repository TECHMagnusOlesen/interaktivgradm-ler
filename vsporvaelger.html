<!doctype html>
<html lang="da">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>V-spors matrice – interaktiv</title>
  <style>
    :root{
      --bg1:#0b0c10;
      --bg2:#111522;

      --card1:rgba(255,255,255,.06);
      --card2:rgba(255,255,255,.03);
      --border:rgba(255,255,255,.10);

      --text:#eaf0ff;
      --muted:#aab3c5;

      --metal1:#e1e1e1;
      --metal2:#bbbbbb;

      --ink:#101114;
      --tick:#0d0f14;

      --danger:#ff6b6b;
      --ok:#7CFF9A;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(1200px 600px at 50% 0%, var(--bg2) 0%, var(--bg1) 60%);
      color:var(--text);
      min-height:100svh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:14px;
    }

    .wrap{ width:min(980px, 100%); display:grid; gap:12px; }

    .top{
      background: linear-gradient(180deg, var(--card1), var(--card2));
      border:1px solid var(--border);
      border-radius:16px;
      padding:12px;
      display:flex;
      flex-wrap:wrap;
      gap:10px 12px;
      align-items:center;
      justify-content:space-between;
    }

    .field{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    label{ font-size:14px; color:var(--muted); }

    input[type="range"]{
      width:min(360px, 72vw);
      accent-color: rgba(110,231,255,.9);
      cursor:pointer;
    }

    .pillrow{ display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end; align-items:center; }
    .pill{
      padding:8px 10px;
      border-radius:999px;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
      font-size:14px;
      color:var(--muted);
      white-space:nowrap;
      backdrop-filter: blur(6px);
    }
    .pill strong{ color:var(--text); font-weight:800; }
    .pill .val{ font-variant-numeric: tabular-nums; }

    .card{
      background: linear-gradient(180deg, var(--card1), var(--card2));
      border:1px solid var(--border);
      border-radius:16px;
      padding:10px;
      overflow:hidden;
    }

    .cardTitle{
      margin: 4px 4px 10px;
      font-size: 14px;
      color: var(--muted);
      line-height: 1.45;
    }

    .svgwrap{
      width:100%;
      display:flex;
      justify-content:center;
      align-items:center;
      user-select:none;
      -webkit-user-select:none;
    }

    svg{ width:100%; height:auto; max-width:980px; display:block; }

    .hint{
      margin-top:10px;
      color:var(--muted);
      font-size:13px;
      line-height:1.35;
      display:flex;
      gap:8px;
      align-items:flex-start;
      padding:0 4px 2px;
    }
    .hint b{ color:var(--text); }

    @media (max-width:520px){
      .pillrow{ justify-content:flex-start }
      .pill{ white-space:normal }
    }

    .backBtn{
      position: fixed;
      top: 12px;
      left: 12px;
      z-index: 50;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 12px;
      border-radius: 12px;
      text-decoration: none;
      color: var(--text);
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.14);
      backdrop-filter: blur(6px);
      -webkit-tap-highlight-color: transparent;
    }
    .backBtn:hover{ background: rgba(255,255,255,.12); }
    .backBtn:active{ transform: translateY(1px); }
  </style>
</head>
<body>

  <a class="backBtn" href="index.html" aria-label="Tilbage til index">← Tilbage</a>

  <div class="wrap">
    <div class="top">
      <div class="field">
        <label for="tSlider">Pladetykkelse (mm)</label>
        <input id="tSlider" type="range" min="1" max="3" step="0.5" value="1.5" list="tMarks" aria-label="Pladetykkelse" />
        <datalist id="tMarks">
          <option value="1"></option>
          <option value="1.5"></option>
          <option value="2"></option>
          <option value="3"></option>
        </datalist>
      </div>

      <div class="pillrow">
        <div class="pill">S: <strong><span class="val" id="sOut">1,5</span> mm</strong></div>
        <div class="pill">V-bredde: <strong><span class="val" id="vOut">12</span> mm</strong></div>
        <div class="pill">Regel: <strong>V = 8·S</strong></div>
      </div>
    </div>

    <div class="card">
      <div class="cardTitle">
        Skub på slideren: den <b>røde plade</b> ændrer tykkelse, og <b>V-sporet</b> i den <b>blå matrice</b> bliver bredere efter reglen <b>V = 8·S</b>. Tegningen er målsat.
      </div>

      <div class="svgwrap">
        <svg id="scene" viewBox="0 0 900 560" role="img" aria-label="Interaktiv V-spors matrice">
          <defs>
            <filter id="softShadow" x="-30%" y="-30%" width="160%" height="160%">
              <feDropShadow dx="0" dy="3" stdDeviation="4" flood-color="#000" flood-opacity=".35"/>
            </filter>
            <marker id="arrow" markerWidth="10" markerHeight="10" refX="5" refY="5" orient="auto-start-reverse">
              <path d="M 0 0 L 10 5 L 0 10 z" fill="rgba(255,255,255,.85)"/>
            </marker>
          </defs>

          <!-- Background guide -->
          <rect x="20" y="20" width="860" height="520" rx="20"
                fill="rgba(255,255,255,.02)" stroke="rgba(255,255,255,.08)"/>

          <!-- RED plate -->
          <g id="plateG" filter="url(#softShadow)">
            <rect id="plateRect" x="140" y="70" width="620" height="90" rx="10"
                  fill="#ff3b3b" opacity="0.95" stroke="rgba(0,0,0,.25)" stroke-width="2"/>
          </g>

          <!-- BLUE die with V groove -->
          <g id="dieG" filter="url(#softShadow)">
            <path id="diePath" d=""
                  fill="#0b43ff" opacity="0.95" stroke="rgba(0,0,0,.30)" stroke-width="2"/>
          </g>

          <!-- DIMENSIONS: thickness S -->
          <g id="dimS" font-family="system-ui, -apple-system, Segoe UI, Roboto, Arial" fill="rgba(255,255,255,.92)">
            <line id="sLine" x1="800" y1="70" x2="800" y2="160"
                  stroke="rgba(255,255,255,.85)" stroke-width="2"
                  marker-start="url(#arrow)" marker-end="url(#arrow)"/>
            <text id="sText" x="800" y="55" text-anchor="middle" font-weight="900" font-size="22">S = 1,5 mm</text>
          </g>

          <!-- DIMENSIONS: V width -->
          <g id="dimV" font-family="system-ui, -apple-system, Segoe UI, Roboto, Arial" fill="rgba(255,255,255,.92)">
            <line id="vLine" x1="330" y1="260" x2="570" y2="260"
                  stroke="rgba(255,255,255,.85)" stroke-width="2"
                  marker-start="url(#arrow)" marker-end="url(#arrow)"/>
            <line id="vExtL" x1="330" y1="240" x2="330" y2="282" stroke="rgba(255,255,255,.65)" stroke-width="2"/>
            <line id="vExtR" x1="570" y1="240" x2="570" y2="282" stroke="rgba(255,255,255,.65)" stroke-width="2"/>
            <text id="vText" x="450" y="232" text-anchor="middle" font-weight="900" font-size="22">12</text>
          </g>

          <!-- Label note -->
          <text x="450" y="520" text-anchor="middle"
                font-family="system-ui, -apple-system, Segoe UI, Roboto, Arial"
                font-size="14" fill="rgba(255,255,255,.70)">
            V-spors bredde vises som topåbningen (mål i mm).
          </text>
        </svg>
      </div>

      <div class="hint">
        <span>ℹ️</span>
        <div>
          Slideren er låst til: <b>1</b>, <b>1,5</b>, <b>2</b>, <b>3</b> mm.
          V-bredden opdateres automatisk: <b>V = 8·S</b>.
        </div>
      </div>
    </div>
  </div>

<script>
(() => {
  const allowed = [1, 1.5, 2, 3];

  const tSlider = document.getElementById('tSlider');
  const sOut = document.getElementById('sOut');
  const vOut = document.getElementById('vOut');

  const plateRect = document.getElementById('plateRect');
  const diePath = document.getElementById('diePath');

  const sLine = document.getElementById('sLine');
  const sText = document.getElementById('sText');

  const vLine = document.getElementById('vLine');
  const vExtL = document.getElementById('vExtL');
  const vExtR = document.getElementById('vExtR');
  const vText = document.getElementById('vText');

  function clamp(v, lo, hi){ return Math.max(lo, Math.min(hi, v)); }

  function nearestAllowed(v){
    let best = allowed[0], bestD = Infinity;
    for(const a of allowed){
      const d = Math.abs(a - v);
      if(d < bestD){ bestD = d; best = a; }
    }
    return best;
  }

  function fmtDK(n){
    const s = (Math.round(n * 10) / 10).toString();
    return s.replace(".", ",");
  }

  function update(thicknessMm){
    const S = thicknessMm;
    const V = 8 * S;

    // Readouts
    sOut.textContent = fmtDK(S);
    vOut.textContent = String(V).replace(".", ",");
    sText.textContent = `S = ${fmtDK(S)} mm`;
    vText.textContent = String(V).replace(".", ",");

    // --- Drawing scales (px) ---
    // (2) Rød plade 2× mindre end før:
    // før: 70*S  -> nu: 35*S
    const tPx = 35 * S; // 35, 52.5, 70, 105

    // V width scale (som før)
    const vPx = 20 * V; // 160..480 px

    // --- Layout anchors ---
    const plateX = 140, plateW = 620;
    const plateTopY = 70;
    const plateH = tPx;

    // Red plate
    plateRect.setAttribute('x', plateX);
    plateRect.setAttribute('y', plateTopY);
    plateRect.setAttribute('width', plateW);
    plateRect.setAttribute('height', plateH);

    // Thickness dimension line (right side of plate)
    const sX = 800;
    sLine.setAttribute('x1', sX);
    sLine.setAttribute('x2', sX);
    sLine.setAttribute('y1', plateTopY);
    sLine.setAttribute('y2', plateTopY + plateH);

    // (3) Sørg for aldrig overlap: flyt matricen ned under pladen med fast gap
    const gap = 70; // luft mellem plade og matrice
    const dieX = 190, dieW = 520, dieH = 250;
    const dieY = plateTopY + plateH + gap;

    const topY = dieY;
    const bottomY = dieY + dieH;

    // Groove
    const grooveW = clamp(vPx, 140, dieW - 80);
    const cx = dieX + dieW / 2;
    const leftGroove = cx - grooveW / 2;
    const rightGroove = cx + grooveW / 2;

    // (1) 45° V-spor: dybde følger bredden (tan45 = 1)
    // dybde = (bredde/2)
    let vDepth = grooveW / 2;

    // Sikkerhed: sørg for at trekanten kan være i matricen
    const maxDepth = dieH - 20; // lidt margin
    vDepth = clamp(vDepth, 20, maxDepth);

    // Die path with V-notch in top edge
    const d = [
      `M ${dieX} ${bottomY}`,
      `L ${dieX} ${topY}`,
      `L ${leftGroove} ${topY}`,
      `L ${cx} ${topY + vDepth}`,
      `L ${rightGroove} ${topY}`,
      `L ${dieX + dieW} ${topY}`,
      `L ${dieX + dieW} ${bottomY}`,
      `Z`
    ].join(" ");
    diePath.setAttribute('d', d);

    // V width dimension (top opening)
    const dimY = topY + 30;
    vLine.setAttribute('y1', dimY);
    vLine.setAttribute('y2', dimY);
    vLine.setAttribute('x1', leftGroove);
    vLine.setAttribute('x2', rightGroove);

    vExtL.setAttribute('x1', leftGroove);
    vExtL.setAttribute('x2', leftGroove);
    vExtL.setAttribute('y1', dimY - 20);
    vExtL.setAttribute('y2', dimY + 22);

    vExtR.setAttribute('x1', rightGroove);
    vExtR.setAttribute('x2', rightGroove);
    vExtR.setAttribute('y1', dimY - 20);
    vExtR.setAttribute('y2', dimY + 22);

    vText.setAttribute('x', cx);
    vText.setAttribute('y', dimY - 26);
  }

  function onSlider(){
    const raw = parseFloat(tSlider.value);
    const snapped = nearestAllowed(raw);
    tSlider.value = String(snapped);
    update(snapped);
  }

  tSlider.addEventListener('input', onSlider);
  onSlider();
})();
</script>

</body>
</html>
